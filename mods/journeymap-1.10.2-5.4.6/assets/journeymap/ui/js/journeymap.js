var JourneyMap=function(){function f(){var a=!0;k||(a=!1,k="day",0===b.world.dimension&&!1===p&&13800<=b.world.time&&(k="night"));var c=!1;a&&(k="day"===k?"night":"night"===k?"topo":"day",c=!0);"day"===k?($("#dayNightText").html(d("day_button_text")),$("#dayNightButton").attr("title",d("day_button_title")),$("#dayNightButtonImg").attr("src","/theme/icon/day.png")):"night"===k?($("#dayNightText").html(d("night_button_text")),$("#dayNightButton").attr("title",d("night_button_title")),$("#dayNightButtonImg").attr("src",
"/theme/icon/night.png")):"topo"===k?($("#dayNightText").html(d("topo_button_text")),$("#dayNightButton").attr("title",d("topo_button_title")),$("#dayNightButtonImg").attr("src","/theme/icon/topo.png")):h&&console.log("\x3e\x3e\x3e Error: Can't set mapType: "+k);c&&!1===p&&(h&&console.log("setMapType("+k+")"),E())}function m(a){(F=a)?($("#followButtonImg").attr("src","/theme/icon/follow.png"),g.playerMarker?(e.panTo(g.playerMarker.getPosition()),Q()):E()):$("#followButtonImg").attr("src","/theme/icon/follow.png")}
var e,I,k,F=!0,y=!0,v=!0,G=!0,r=0,w=!1,J=!1,R=!1,p=!1,z=0,t=null,b={debug:!1,messages:null,properties:null,mobs:null,animals:null,players:null,villagers:null,waypoints:null,images:null},g={},x=null,u=null,h=!1;$("\x3cimg\x3e").attr("src","/img/pixel.png");var W=function(){var a=0;return function(c,b){clearTimeout(a);a=setTimeout(c,b)}}(),Y=function(){h&&console.log("\x3e\x3e\x3e initGame");$.ajax({url:"/data/world",dataType:"jsonp",contentType:"application/javascript; charset\x3dutf-8"}).fail(H).done(function(a,
c,ha){b.world=a;_gaq.push(["_setCustomVar",1,"jm_version",b.world.jm_version,2]);_gaq.push(["_setCustomVar",2,"mc_version",b.world.mc_version,2]);$("#version").html("JourneyMap "+b.world.jm_version);x||(u=S(b.world.mod_name+"\x3cbr\x3e\x3csmall\x3eby techbrew\x3c/small\x3e"));X()})},X=function(){h&&console.log("\x3e\x3e\x3e initUI");if(!b.messages)throw"initUI called without JM.messages";$("html").attr("lang",b.messages.locale.split("_")[0]);$("link #rssfeed").attr("title",d("rss_feed_title"));$("#jm-menu").menu().hide().find("a").click(function(){_gaq.push(["_trackEvent",
"menu","link",this.href]);return!0});$("#jm-button").button({icons:{secondary:"ui-icon-triangle-1-s"}}).click(function(){var a=$("#jm-menu");if($(a).is(":visible"))a.hide();else{var c=$("#jm-button");a.show().position({my:"left top",at:"left bottom",of:c});$(document).one("click",function(){a.hide()})}return!1});$("#webLink").attr("title",d("web_link_title"));$("#webLinkText").html(d("web_link_text"));$("#forumLink").attr("title",d("forum_link_title"));$("#forumLinkText").html(d("forum_link_text"));
$("#rssLink").attr("title",d("rss_feed_title"));$("#rssLinkText").html(d("rss_feed_text"));$("#emailLink").attr("title",d("email_sub_title"));$("#emailLinkText").html(d("email_sub_text"));$("#twitterLink").attr("title",d("follow_twitter_title"));$("#twitterLinkText").html(d("follow_twitter_text"));$("#donateLink").attr("title",d("donate_title"));$("#donateLinkText").html(d("donate_text"));$("#dayNightButton").attr("title",d("day_button_title")).click(function(){R=!0;f()});$("#dayNightButton").parent().buttonset();
$("#followButton").attr("title",d("follow_button_title")).click(function(){m(!F)});$("#jm-toggles").buttonset();$("#jm-options-menu").menu().hide();$("#jm-options-button").attr("title",d("show_menu_text"));$("#jm-options-button").button({icons:{secondary:"ui-icon-triangle-1-s"}}).click(function(){$("#jm-actions-menu").hide();var a=$("#jm-options-menu");$(a).is(":visible")?a.hide():(Z("#checkShowCaves",b.world.features.MapCaves),a.show(),$(document).one("click",function(){a.hide()}));return!1});$("#jm-options-menu").click(function(a){a.stopPropagation()});
K("#cavesMenuItem","caves_menu_item_text","caves_menu_item_title");K("#waypointsMenuItem","waypoints_menu_item_text","waypoints_menu_item_title");K("#gridMenuItem","grid_menu_item_text","grid_menu_item_title");$("#checkShowCaves")[0].checked=y;$("#checkShowCaves").click(function(a){y=!0===a.target.checked;L("showCaves",y);p&&E()});$("#checkShowGrid")[0].checked=G;$("#checkShowGrid").click(function(a){G=!0===a.target.checked;L("showGrid",G);setTimeout(function(){window.location=window.location},1500)});
$("#checkShowWaypoints")[0].checked=v;$("#checkShowWaypoints").click(function(a){v=!0===a.target.checked;L("showWaypoints",v);v||(b.waypoints=null)});$("#jm-actions-menu").menu().hide();$("#jm-actions-button").attr("title",d("actions_title"));$("#jm-actions-button").button({icons:{secondary:"ui-icon-triangle-1-s"}}).click(function(){$("#jm-options-menu").hide();var a=$("#jm-actions-menu");$(a).is(":visible")?a.hide():(!0===b.world.singlePlayer?$("#autoMapButton").removeClass("ui-state-disabled"):
$("#autoMapButton").addClass("ui-state-disabled"),a.show(),$(document).one("click",function(){a.hide()}));return!1});$("#saveButton").attr("title",d("save_button_title")).click(function(){aa()});$("#saveButtonText").html(d("save_button_text"));$("#autoMapButton").attr("title",d("automap_title")).click(function(){if(!0===b.world.singlePlayer)ba();else return!1});$("#autoMapButtonText").html(d("automap_text"));$("#worldInfo").hide();$("#worldNameLabel").html(d("worldname_text"));$("#worldTimeLabel").html(d("worldtime_text"));
$("#playerBiomeLabel").html(d("biome_text"));$("#playerLocationLabel").html(d("location_text"));$("#playerElevationLabel").html(d("elevation_text"));$(".nav").disableSelection();h&&console.log("\x3e\x3e\x3e initWorld");p=w=!1;z=0;null!==t&&(clearInterval(t),t=null);b.mobs={};b.animals={};b.players={};b.villagers={};b.waypoints={};b.images={};g={mobs:{},animals:{},players:{},villagers:{},waypoints:{},player:{}};$("#map-canvas");T(ca)},Z=function(a,c){!0!==c?($(a).attr("disabled",!0).parent().find("span").addClass("ui-state-disabled"),
$(a).parent().children().css("cursor","not-allowed")):($(a).removeAttr("disabled").parent().find("span").removeClass("ui-state-disabled"),$(a).parent().children().css("cursor","pointer"))},L=function(a,c){$.ajax({type:"POST",url:"/properties",data:a+"\x3d"+c}).fail(function(a,c,b){h&&console.log("\x3e\x3e\x3e postPreference failed: "+a.status,c)}).done(function(){h&&console.log("\x3e\x3e\x3e postPreference done: "+a)})},K=function(a,c,b){$(a).html(d(c)).prop("title",d(b))},ca=function(){e=da($("#map-canvas")[0]);
e.controls[google.maps.ControlPosition.TOP_LEFT].push($("#jm-logo-span")[0]);e.controls[google.maps.ControlPosition.TOP_CENTER].push($("#jm-toolbar")[0]);e.controls[google.maps.ControlPosition.TOP_CENTER].push($("#jm-toggles")[0]);e.controls[google.maps.ControlPosition.TOP_CENTER].push($("#jm-rt-menus")[0]);e.controls[google.maps.ControlPosition.BOTTOM_CENTER].push($("#worldInfo")[0]);google.maps.event.addListener(e,"click",function(a){e.getProjection().fromPointToLatLng(a.pixel)});x&&($(".ui-dialog").remove(),
x=null);u&&$(u).parent().delay(1E3).fadeOut(1E3,function(){$(".ui-dialog").remove();u=null});m(!0);b.world.latest_journeymap_version>b.world.jm_version&&window.setTimeout(function(){var a=d("update_button_title"),a=a.replace("%1$s",b.world.latest_journeymap_version),a=a.replace("%2$s",b.world.mc_version),c=function(a){a=$("#webLink")[0].href;window.open(a,"_new","")};$("#jm-update-button").button().attr("title",a).click(c);e.controls[google.maps.ControlPosition.TOP_CENTER].push($("#jm-alerts")[0]);
B(a,2500,c)},3E3)},aa=function(){_gaq.push(["_trackEvent","saveMapImage",null,0,!0]);$.ajax({type:"POST",url:"/action?type\x3dsavemap"+M(),dataType:"jsonp"}).fail(function(a,c,b){console.log("\x3e\x3e\x3e saveMapImage failed: "+JSON.stringify(a));a="Error: "+JSON.stringify(a);B(a,2E3)}).success(function(a){console.log("automap result: ",a);a=d("save_filename",a.filename);B(a,2E3)})},ba=function(){var a=$('\x3cdiv class\x3d"message"\x3e\x3c/div\x3e').html(d("automap_dialog_text")).css("z-index",google.maps.Marker.MAX_ZINDEX+
1).css("min-height","20px").dialog({modal:!0,buttons:[{width:"80px",text:d("automap_dialog_all"),click:function(){N("all");$(this).dialog("close")}},{width:"80px",text:d("automap_dialog_missing"),click:function(){N("missing");$(this).dialog("close")}},{width:"80px",text:d("automap_dialog_none"),click:function(){N("stop");$(this).dialog("close")}},{width:"80px",text:d("automap_dialog_close"),click:function(){$(this).dialog("close")}}]}).parent().find(".ui-dialog-titlebar").remove();$(a).find(".ui-dialog-buttonset").css("width",
"100%")},N=function(a){_gaq.push(["_trackEvent","toggleAutoMap",null,0,!0]);$.ajax({type:"POST",url:"/action?type\x3dautomap\x26scope\x3d"+a,dataType:"jsonp"}).fail(function(a,b,d){console.log("\x3e\x3e\x3e toggleAutoMap failed: "+JSON.stringify(a));a="Error: "+JSON.stringify(a);B(a,2E3)}).success(function(a){console.log("automap result: ",a);a=d(a.message);B(a,2E3)})},B=function(a,c,b){var d=$('\x3cdiv class\x3d"message"\x3e\x3c/div\x3e').dialog({modal:!1}),e=function(){$(d).remove();d=null};$(d).css("z-index",
google.maps.Marker.MAX_ZINDEX+1).css("min-height","20px").html(a).click(function(){b&&b();e()}).parent().find(".ui-dialog-titlebar").remove();$(d).parent().delay(2E3).fadeOut(1500,e)},T=function(a){if(!0!==w){2<z&&(h&&console.log("Too many queries pending, resetting."),window.location=window.location);var c="";e&&(r||(r=(new Date).getTime()),c="?images.since\x3d"+r);z++;ea("/data/all"+c,function(c){z--;b.animals=c.animals;b.images=c.images;b.mobs=c.mobs;b.player=c.player;b.players=c.players;b.villagers=
c.villagers;b.waypoints=c.waypoints;b.world=c.world;c=p;p=b.player.underground;$("#playerBiome").html(b.player.biome);$("#playerLocation").html(Math.round(b.player.posX)+","+Math.round(b.player.posZ));$("#playerElevation").html(Math.round(b.player.posY)+"\x26nbsp;("+(b.player.posY>>4)+")");var d=b.world.time/20,q=Math.floor(d/60),d=Math.ceil(d%60);10>q&&(q="0"+q);10>d&&(d="0"+d);q=q+":"+d;$("#worldName").html(unescape(b.world.name).replace("\\+"," "));$("#worldTime").html(q);$("#worldInfo").show();
1!=R&&0===b.world.dimension&&!1===p&&(k=null,f());!0!==w&&(e&&(c!==p?E():I.refreshTiles(),h&&console.log("\x3e\x3e\x3e drawMap"),!0===J?h&&console.log("\x3e\x3e\x3e Avoided concurrent drawMap()"):(J=!0,h&&console.log("\x3e\x3e\x3e drawMobs"),0!==e.getZoom()&&(C(b.mobs,g.mobs),C(b.animals,g.animals),C(b.villagers,g.villagers)),h&&console.log("\x3e\x3e\x3e drawMultiplayers"),C(b.players,g.players),U(),Q(),J=!1)),null===t&&(t=setInterval(T,Math.max(1E3,b.world&&b.world.browser_poll?b.world.browser_poll:
1E3))),a&&a())})}},ea=function(a,c){h&&console.log("\x3e\x3e\x3e fetchData "+a);$.ajax({url:a,dataType:"jsonp"}).fail(H).done(c)},E=function(){h&&console.log("\x3e\x3e\x3e refreshMap");e&&W(function(){h&&console.log("\x3e\x3e\x3e delayed refreshMap");r=1;var a=e.getZoom(),c=a==n.maxZoom?-1E-7:1E-7,b=e.getCenter();e.setZoom(a+c);e.panTo(b);e.setZoom(a);e.panTo(b)},500)},d=function(a,c){if(b.messages&&b.messages[a]){var d=b.messages[a],d=d.replace("Format error: ","");return c?(Array.isArray(c)||(c=
[c]),d.format.apply(d,c)):d}console.log("Missing L10N message: "+a);return"!"+a+"!"},H=function(a,c,b){h&&console.log("\x3e\x3e\x3e handleError");!0!==w&&(_gaq.push(["_trackEvent","handleError",JSON.stringify(a),0,!0]),null!==t&&(clearInterval(t),t=null),z=!1,console&&console.log&&console.log("Server returned error: "+JSON.stringify(a)),$(".nav").appendTo($("#nav-holder")),$("#map-canvas").empty(),u&&($(u).remove(),u=null),a=503===a.status||0===a.status?d("error_world_not_opened"):"",x||(x=S(a,!0)),
$(x).find("div").html(a),w||(w=!0,console&&console.log("\x3e\x3e\x3e Will re-check game state in 5 seconds."),setTimeout(function(){document.location=document.location},5E3)))},S=function(a,c){c||(c=!1);var b=$('\x3cdiv class\x3d"dialog"\x3e\x3cimg src\x3d"/img/ico/journeymap144.png"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e').dialog({modal:c});b.parent().find(".ui-dialog-titlebar").remove();b.css("z-index",google.maps.Marker.MAX_ZINDEX+1);a&&b.find("div").html(a);return b},Q=function(){h&&console.log("\x3e\x3e\x3e drawPlayer");
var a=O(b.player.posX,b.player.posZ),c=b.player.heading,d="player"+b.player.username;g.playerMarker||(d=$('\x3cdiv class\x3d"playerMarker" id\x3d""\x3e\x3cdiv class\x3d"playerImages"\x3e\x3cimg class\x3d"playerLocator" src\x3d"/img/marker-player-bg-32.png"\x3e\x3cimg class\x3d"playerLocator filter-tint" src\x3d"/img/marker-player-32.png"\x3e\x3c/div\x3e\x3c/div\x3e').attr("id",d),g.playerMarker=new RichMarker({position:a,map:e,draggable:!1,flat:!0,anchor:RichMarkerPosition.MIDDLE,content:d[0],zIndex:google.maps.Marker.MAX_ZINDEX+
1,tooltip:new RichMarker({position:null,map:null,draggable:!1,flat:!0,anchor:RichMarkerPosition.BOTTOM,content:'\x3cdiv class\x3d"playerInfo"\x3e'+b.player.username+"\x3c/div\x3e"})}),$(d).find(".filter-tint").one("load",function(a){P(a.target)}),google.maps.event.addListener(g.playerMarker,"mouseover",function(a){a=g.playerMarker.tooltip;a.timeout&&window.clearTimeout(a.timeout);a.getMap()||(a.setPosition(g.playerMarker.position),a.setMap(g.playerMarker.map),a.setZIndex(google.maps.Marker.MAX_ZINDEX+
1))}),google.maps.event.addListener(g.playerMarker,"mouseout",function(a){var c=g.playerMarker.tooltip;c.getMap()&&(c.timeout&&window.clearTimeout(c.timeout),c.timeout=window.setTimeout(function(){delete c.timeout;c.setMap(null)},500))}),google.maps.event.addListener(e,"dragstart",function(){m(!1)}),google.maps.event.addListener(e,"zoom_changed",function(){document.getSelection().removeAllRanges();!0===F&&g.playerMarker&&e.panTo(g.playerMarker.getPosition());g.waypoints&&U();0==e.getZoom()?$("img.entityLocator").css("visibility",
"hidden"):$("img.entityLocator").css("visibility","visible");0==e.getZoom()?$("img.entityMarker").css("visibility","hidden"):$("img.entityMarker").css("visibility","visible")}));g.playerMarker.setPosition(a);$(g.playerMarker.content).find("img").rotate(c);fa(g.playerMarker.content,b.player.color);g.playerMarker.getZIndex()<google.maps.Marker.MAX_ZINDEX&&g.playerMarker.setZIndex(google.maps.Marker.MAX_ZINDEX+1);!0===F&&e.panTo(a)},C=function(a,c){$.each(c,function(b,d){a&&b in a||(d.setMap(null),h&&
console.log("Marker removed for "+b),delete c[b])})},U=function(){h&&console.log("\x3e\x3e\x3e drawWaypoints");C(b.waypoints,g.waypoints);1!=!v&&b.waypoints&&$.each(b.waypoints,function(a,c){var f=g.waypoints,A=V(c.x,c.primaryDimension,b.player.dimension),q=V(c.z,c.primaryDimension,b.player.dimension),A=O(A,q);if(e.getBounds().contains(A)){q=c.id;c.color="#"+(16777216+(c.r<<16)+(c.g<<8)+c.b).toString(16).slice(1);var l=f[q];if(l)l.icon.fillColor!==c.color&&(l.icon.fillColor=c.color,l.setIcon(l.icon)),
l.setPosition(A);else{var l={fillOpacity:.85,scale:1,fillColor:c.color,strokeColor:"white"},k="waypoint";"Death"==c.type?(l.path="M -10,-10 0,-4 10,-10 14,-8 4,0 14,8 10,10 0,4 -10,10 -14,8 -4,0 -14,-8 z",l.strokeWeight=1.5,k+=" death"):(l.path="M 0,-8 8,0 0,8 -8,0 0,-8 z",l.strokeWeight=1.5);var n=[d("location_text"),c.x+","+c.z,d("elevation_text"),c.y,"("+(c.y>>4)+")"].join(" "),m=c.name,p=$("\x3cspan/\x3e").addClass(k).html(m).hide().appendTo(document.body),r=4+$(p).innerWidth()/2;$(p).remove();
l=new MarkerWithLabel({position:A,map:e,draggable:!1,clickable:!1,icon:l,title:n,labelContent:m,labelClass:k,labelAnchor:new google.maps.Point(r,40)});f[q]=l;h&&console.log("Marker added for "+q)}}})},fa=function(a,c){var b=ga(c);$.each($(a).find(".filter-tint"),function(a,c){var d=$(c);d.attr("data-pb-tint-colour")!==b&&(d.attr("data-pb-tint-colour",b),d.attr("data-pb-tint-opacity","1.0"),P(d))})},P=function(a){$(a).is(":visible")?processFilters():setTimeout(function(){P(a)},50)},V=function(a,c,
b){return c==b?a:-1==c?8*a:-1==b?a/8:a},M=function(){return"\x26mapType\x3d"+(!0===b.world.features.MapCaves&&!0===p&&!0===y?"underground":k)+"\x26dim\x3d"+b.player.dimension+"\x26depth\x3d"+(b.player&&void 0!=b.player.chunkCoordY?b.player.chunkCoordY:4)+"\x26ts\x3d"+r},ga=function(a){a=[a>>16&255,a>>8&255,a&255];return"#"+(16777216+(a[0]<<16)+(a[1]<<8)+a[2]).toString(16).slice(1)},h="true"===decodeURI((/debug=(.+?)(&|$)/.exec(location.search)||[,null])[1]);google.maps.visualRefresh=!0;var n={tileSize:512,
defaultZoom:0,minZoom:0,maxZoom:5};n.perPixel=1/n.tileSize;var O=function(a,b){return new google.maps.LatLng(b*n.perPixel,a*n.perPixel)},da=function(a){var c;c=b.player&&b.player.posX?O(b.player.posX,b.player.posZ):new google.maps.LatLng(0,0);e=new google.maps.Map(a,{zoom:n.defaultZoom,center:c,mapTypeControl:!1,streetViewControl:!1,panControl:!0,panControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.AUTO,position:google.maps.ControlPosition.LEFT_TOP}});
I=new D;e.mapTypes.set("jm",I);e.setMapTypeId("jm");return e},D=function(){this.loadedTiles={};this.projection=new MCMapProjection(n.tileSize);this.tileSize=new google.maps.Size(n.tileSize,n.tileSize);this.minZoom=n.minZoom;this.maxZoom=n.maxZoom};D.prototype.getTile=function(a,b,d){b=Math.floor(b);var e="/tile?zoom\x3d"+b+"\x26x\x3d"+a.x+"\x26z\x3d"+a.y,g="x_"+a.x+"_y_"+a.y+"_zoom_"+b,l=d.createElement("div");$(l).css("width",this.tileSize.height+"px").css("width",this.tileSize.height+"px").css("height",
this.tileSize.height+"px").attr("data-tileid",g);h&&(d=d.createElement("span"),$(d).css("color","white").css("float","left").html(a.toString()+" zoom "+b),$(l).append(d));var f=$("\x3cimg\x3e").attr("src",e+=M());if(0<f.width())$(l).prepend(f);else $(f).on("load",function(){$(l).prepend(f)});this.loadedTiles[g]={tile:l,tileUrl:e,coord:a,zoom:b};return l};D.prototype.refreshTile=function(a){h&&console.log("\x3e\x3e\x3e refreshTile "+$(a).data("tileid"));var b=this.loadedTiles[$(a).data("tileid")];
b&&(b=b.tileUrl+M(),$(a).find("img").attr("src",b))};D.prototype.refreshTiles=function(a){var c=this;a=a||!1;h&&console.log("\x3e\x3e\x3e refreshTiles: "+a);if(a){for(var d in c.loadedTiles){a=c.loadedTiles[d];var e=a.tile;c.refreshTile(e)}r=b.images.queryTime}else if(0===b.images.regions.length)h&&console.log("No regions have changed: ",b.images),r=b.images.queryTime||(new Date).getTime();else for(d in r=b.images.queryTime||(new Date).getTime(),h&&console.log("Regions changed since "+b.images.since+
": "+b.images.regions.join(", ")),c.loadedTiles)if(a=c.loadedTiles[d]){var e=a.tile,f=a.zoom,g=Math.pow(2,f),k=a.coord,m=[parseInt(k.x/g),parseInt(k.y/g)];b.images.regions.forEach(function(a){return m[0]==a[0]&&m[1]==a[1]?(h&&console.log("    tile "+k+" zoom "+f+" in region: ",m),c.refreshTile(e),!1):!0})}};D.prototype.releaseTile=function(a){delete this.loadedTiles[a.tileId]};return{start:function(){h&&console.log("\x3e\x3e\x3e initMessages");$.ajax({url:"/properties",dataType:"jsonp",contentType:"application/javascript; charset\x3dutf-8"}).fail(H).done(function(a,
c,d){b.properties=a;y=b.properties.showCaves;G=b.properties.showGrid;v=b.properties.showWaypoints;$.ajax({url:"/data/messages",dataType:"jsonp",contentType:"application/javascript; charset\x3dutf-8"}).fail(H).done(function(a,c,d){b.messages=a;Y()})})}}}();function MCMapProjection(f){this.tileSize=f;this.inverseTileSize=1/f}MCMapProjection.prototype.fromLatLngToPoint=function(f){var m=f.lng()*this.tileSize;f=f.lat()*this.tileSize;return new google.maps.Point(m,f)};
MCMapProjection.prototype.fromPointToLatLng=function(f){return new google.maps.LatLng(f.y*this.inverseTileSize,f.x*this.inverseTileSize)};var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-28839029-1"]);_gaq.push(["_setDomainName","none"]);_gaq.push(["_setAllowLinker",!0]);_gaq.push(["_trackPageview"]);
(function(){var f=document.createElement("script");f.type="text/javascript";f.async=!0;f.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var m=document.getElementsByTagName("script")[0];m.parentNode.insertBefore(f,m)})();function ga_heartbeat(){_gaq.push(["_trackEvent","heartbeat","heartbeat",null,0,!0]);setTimeout(ga_heartbeat,3E5)}ga_heartbeat();
String.prototype.format||(String.prototype.format=function(){var f=arguments;return this.replace(/{(\d+)}/g,function(m,e){return"undefined"!=typeof f[e]?f[e]:m})});$(document).ready(function(){_gaq.push(["_trackEvent","document","ready",null,0,!0]);JourneyMap.start()});$(window).unload(function(){_gaq.push(["_trackEvent","document","unload",null,0,!0])});